---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getPageContent, pickSection, getSeoMeta } from '../lib/content.js';

type HeroSection = {
  title?: string;
  subtitle?: string;
  slides?: string[];
  images?: string[];
};

const cmsPage = getPageContent('homepage');
const seo = getSeoMeta(cmsPage, {
  title: 'Field & Tides Restaurant & Bar | Houston Heights',
  description: 'Coastal dining in Houston Heights featuring seasonal menus and fresh Gulf seafood.'
});

const fallbackSlides: string[] = [
  '/images/1HOMEREDFISH-1.jpg',
  '/images/2HOMECOUNTRYHAM-1.jpg',
  '/images/3BLUEBERRYGINGER-1.jpg',
  '/images/4HOMECHICKENPICATTA-1.jpg',
  '/images/5MUSHROOMPICATTA-1.jpg',
  '/images/6LAMBSHANK-1.jpg',
  '/images/7HOMEARUGALA-1.jpg',
  '/images/8HOMEKITCHEN-1.jpg'
];

const heroSection = pickSection<HeroSection>(cmsPage, 'hero', {});
const heroSlides: string[] =
  Array.isArray(heroSection?.slides) && heroSection.slides.length > 0
    ? (heroSection.slides as string[])
    : Array.isArray(heroSection?.images) && heroSection.images.length > 0
      ? (heroSection.images as string[])
      : fallbackSlides;
const heroTitle = heroSection?.title ?? 'Field & Tides Restaurant & Bar';
---

<BaseLayout
  title={seo.title}
  description={seo.description}
  keywords={seo.keywords}
  image={seo.image}
  heroFocus={true}
>
  <!-- Hero Slider -->
  <div
    class="relative overflow-hidden"
    style="height: calc(100vh - var(--layout-header-height, 80px) - var(--layout-footer-height, 140px)); min-height: max(420px, calc(100vh - var(--layout-header-height, 80px) - var(--layout-footer-height, 140px)));"
  >
    <div id="hero-slider" class="relative w-full h-full">
      {heroSlides.map((image, index) => (
        <div
          class={`absolute inset-0 transition-opacity duration-[1500ms] ${index === 0 ? 'opacity-100' : 'opacity-0'}`}
          data-slide={index}
        >
          <img
            src={image}
            alt={heroTitle}
            class="w-full h-full object-cover scale-105"
            style="animation: slowZoom 20s ease-out infinite;"
          />
        </div>
      ))}
    </div>

    <!-- Subtle gradient vignette -->
    <div class="absolute inset-0 bg-gradient-radial from-transparent via-transparent to-midnight/30"></div>
  </div>

  <style>
    @keyframes slowZoom {
      0%, 100% { transform: scale(1.05); }
      50% { transform: scale(1.1); }
    }
  </style>

  <script>
    function initHeroSlider() {
      const slides = document.querySelectorAll('#hero-slider [data-slide]');
      if (slides.length === 0) return;

      let currentSlide = 0;

      function showSlide(index: number) {
        slides.forEach((slide, i) => {
          if (i === index) {
            slide.classList.remove('opacity-0');
            slide.classList.add('opacity-100');
          } else {
            slide.classList.remove('opacity-100');
            slide.classList.add('opacity-0');
          }
        });
      }

      function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
      }

      setInterval(nextSlide, 5000);
    }

    document.addEventListener('DOMContentLoaded', initHeroSlider);
    document.addEventListener('astro:page-load', initHeroSlider);
  </script>

</BaseLayout>
