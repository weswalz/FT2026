---
const currentPath = Astro.url.pathname;

const navigation = [
  { name: 'Home', href: '/' },
  {
    name: 'Menus',
    href: '/menu',
    submenu: [
      { name: 'All Menus', href: '/menu' },
      { name: 'Dinner', href: '/menu-dinner' },
      { name: 'Lunch', href: '/menu-lunch' },
      { name: 'Brunch', href: '/menu-brunch' },
      { name: 'Happy Hour', href: '/menu-happy-hour' },
      { name: 'Wine', href: '/menu-wine' },
      { name: 'Cocktails & Beer', href: '/menu-cocktails-beer' },
      { name: 'Kids Menu', href: '/menu-kids' },
      { name: 'Dessert', href: '/dessert' },
      { name: 'Dessert Cocktails & Ports', href: '/dessert-cocktails-ports' }
    ]
  },
  { name: 'Private Events', href: '/private-events' },
  { name: 'Our Story', href: '/ourstory' },
  { name: 'Location', href: '/location' },
  { name: 'Contact', href: '/contact' }
];
---

<header
  id="main-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  data-header
>
  <nav class="container-custom">
    <div class="flex items-center justify-between h-20 md:h-24">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 z-10">
        <div class="text-2xl md:text-3xl font-heading font-bold text-field-navy">
          Field <span class="text-field-copper">&</span> Tides
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-8">
        {navigation.map(item => (
          item.submenu ? (
            <div class="relative group">
              <button
                class="text-midnight hover:text-field-navy transition-colors duration-200 font-medium flex items-center gap-1"
              >
                {item.name}
                <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="absolute left-0 mt-2 w-56 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform group-hover:translate-y-0 translate-y-2">
                <div class="bg-white rounded-xl shadow-lg shadow-slate-200/50 py-2 border border-slate-100">
                  {item.submenu.map(subitem => (
                    <a
                      href={subitem.href}
                      class={`block px-4 py-2 text-sm hover:bg-field-shell transition-colors ${
                        currentPath === subitem.href ? 'text-field-navy font-medium' : 'text-midnight'
                      }`}
                    >
                      {subitem.name}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={item.href}
              class={`link-underline text-midnight hover:text-field-navy transition-colors duration-200 font-medium ${
                currentPath === item.href ? 'text-field-navy' : ''
              }`}
            >
              {item.name}
            </a>
          )
        ))}
        <a href="/giftcards" class="btn btn-secondary !py-2 !px-5">
          Gift Cards
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="lg:hidden z-10 p-2 text-midnight hover:text-field-navy transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path class="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          <path class="close-icon hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="lg:hidden fixed inset-0 bg-white transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto pt-24 pb-8"
    >
      <div class="container-custom">
        <div class="space-y-4">
          {navigation.map(item => (
            <div>
              {item.submenu ? (
                <div>
                  <button
                    class="w-full text-left py-3 text-lg font-medium text-midnight hover:text-field-navy transition-colors flex items-center justify-between"
                    data-mobile-dropdown
                  >
                    {item.name}
                    <svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div class="pl-4 space-y-2 max-h-0 overflow-hidden transition-all duration-300" data-mobile-submenu>
                    {item.submenu.map(subitem => (
                      <a
                        href={subitem.href}
                        class={`block py-2 text-base ${
                          currentPath === subitem.href ? 'text-field-navy font-medium' : 'text-midnight/70'
                        }`}
                      >
                        {subitem.name}
                      </a>
                    ))}
                  </div>
                </div>
              ) : (
                <a
                  href={item.href}
                  class={`block py-3 text-lg font-medium hover:text-field-navy transition-colors ${
                    currentPath === item.href ? 'text-field-navy' : 'text-midnight'
                  }`}
                >
                  {item.name}
                </a>
              )}
            </div>
          ))}
          <a href="/giftcards" class="btn btn-secondary w-full mt-6">
            Gift Cards
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  // Header scroll effect
  function initHeader() {
    const header = document.querySelector('[data-header]');
    let lastScroll = 0;

    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;

      if (currentScroll > 50) {
        header?.classList.add('backdrop-blur-nav', 'shadow-md');
      } else {
        header?.classList.remove('backdrop-blur-nav', 'shadow-md');
      }

      lastScroll = currentScroll;
    });
  }

  // Mobile menu toggle
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = menuButton?.querySelector('.menu-icon');
    const closeIcon = menuButton?.querySelector('.close-icon');

    menuButton?.addEventListener('click', () => {
      const isOpen = mobileMenu?.classList.contains('translate-x-0');

      if (isOpen) {
        mobileMenu?.classList.remove('translate-x-0');
        mobileMenu?.classList.add('translate-x-full');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        menuButton?.setAttribute('aria-expanded', 'false');
      } else {
        mobileMenu?.classList.add('translate-x-0');
        mobileMenu?.classList.remove('translate-x-full');
        menuIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        menuButton?.setAttribute('aria-expanded', 'true');
      }
    });

    // Mobile dropdown toggles
    const dropdownButtons = document.querySelectorAll('[data-mobile-dropdown]');
    dropdownButtons.forEach(button => {
      button.addEventListener('click', () => {
        const submenu = button.nextElementSibling as HTMLElement;
        const svg = button.querySelector('svg');
        const isOpen = submenu?.style.maxHeight && submenu.style.maxHeight !== '0px';

        if (isOpen) {
          submenu.style.maxHeight = '0';
          svg?.classList.remove('rotate-180');
        } else {
          submenu.style.maxHeight = submenu.scrollHeight + 'px';
          svg?.classList.add('rotate-180');
        }
      });
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    initHeader();
    initMobileMenu();
  });

  // Re-initialize on page navigation (for SPA-like behavior)
  document.addEventListener('astro:page-load', () => {
    initHeader();
    initMobileMenu();
  });
</script>

<style>
  /* Ensure mobile menu is above content */
  #mobile-menu {
    z-index: 40;
  }
</style>
