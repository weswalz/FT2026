---
const currentPath = Astro.url.pathname;

const navigation = [
  { name: 'OUR STORY', href: '/ourstory' },
  { name: 'MENU', href: '/menu' },
  { name: 'LOCATION', href: '/location' },
  { name: 'PRIVATE EVENTS', href: '/private-events' }
];
---

<header
  id="main-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  data-header
>
  <div
    data-header-bg
    class="absolute inset-0 pointer-events-none backdrop-blur-md transition-all duration-300"
    style="background: linear-gradient(180deg, rgba(255,255,255,0.68) 0%, rgba(17,76,135,0.18) 100%); box-shadow: 0 1px 4px rgb(0 0 0 / 0.08);"
  ></div>

  <div data-top-accent class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-champagne/25 to-transparent transition-all duration-300"></div>
  <div data-bottom-accent class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-field-navy/15 to-transparent transition-all duration-300"></div>

  <nav class="container-custom relative z-10">
    <div class="flex items-center justify-between py-3 gap-6 min-h-[64px]">
      <a href="/" class="flex items-center z-10 transition-all duration-200 hover:scale-[1.03]">
        <img src="/images/ft2023.svg" alt="Field & Tides" class="h-11 md:h-12 w-auto" />
      </a>

      <div class="hidden lg:flex items-center gap-6">
        {navigation.map(item => (
          <a
            href={item.href}
            class={`text-midnight/90 hover:text-field-navy transition-colors duration-200 font-heading font-semibold text-[0.85rem] tracking-[0.24em] ${
              currentPath === item.href ? 'text-field-navy' : ''
            }`}
          >
            {item.name}
          </a>
        ))}
        <a href="/contact" class="px-6 py-2.5 bg-champagne text-midnight font-heading font-semibold text-sm tracking-[0.28em] rounded-md hover:bg-champagne/90 transition-all duration-200 shadow-sm">
          RESERVE
        </a>
      </div>

      <button
        id="mobile-menu-button"
        class="lg:hidden z-10 p-2 text-midnight hover:text-field-navy transition-all rounded-md hover:bg-field-navy/5"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path class="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16" />
          <path class="close-icon hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="lg:hidden fixed inset-0 bg-white transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto pt-24 pb-8"
    >
      <div class="container-custom">
        <div class="space-y-4">
          {navigation.map(item => (
            <a
              href={item.href}
              class={`block py-3 text-lg font-heading font-semibold uppercase tracking-wide hover:text-field-navy transition-colors ${
                currentPath === item.href ? 'text-field-navy' : 'text-midnight'
              }`}
            >
              {item.name}
            </a>
          ))}
          <a href="/contact" class="inline-block bg-champagne text-midnight font-heading font-bold py-3 px-6 rounded w-full mt-6 uppercase tracking-wide hover:bg-champagne/90 transition-all duration-300 text-center text-sm">
            Reservations
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  // Header scroll effect
  function initHeader() {
    const header = document.querySelector('[data-header]') as HTMLElement;
    const headerBg = header?.querySelector('[data-header-bg]') as HTMLElement;
    const topAccent = header?.querySelector('[data-top-accent]') as HTMLElement;
    const bottomAccent = header?.querySelector('[data-bottom-accent]') as HTMLElement;

    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;

      if (currentScroll > 50) {
        // Enhanced shadow and accent on scroll
        if (headerBg) {
          headerBg.style.boxShadow = '0 18px 35px -18px rgb(17 76 135 / 0.55)';
          headerBg.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.69) 0%, rgba(17,76,135,0.32) 100%)';
        }
        if (topAccent) {
          topAccent.style.opacity = '1';
        }
        if (bottomAccent) {
          bottomAccent.style.opacity = '1';
          bottomAccent.style.height = '2px';
        }
      } else {
        if (headerBg) {
          headerBg.style.boxShadow = '0 1px 4px rgb(0 0 0 / 0.08)';
          headerBg.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.68) 0%, rgba(17,76,135,0.18) 100%)';
        }
        if (topAccent) {
          topAccent.style.opacity = '0.5';
        }
        if (bottomAccent) {
          bottomAccent.style.opacity = '0.5';
          bottomAccent.style.height = '1px';
        }
      }
    });
  }

  // Mobile menu toggle
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = menuButton?.querySelector('.menu-icon');
    const closeIcon = menuButton?.querySelector('.close-icon');

    menuButton?.addEventListener('click', () => {
      const isOpen = mobileMenu?.classList.contains('translate-x-0');

      if (isOpen) {
        mobileMenu?.classList.remove('translate-x-0');
        mobileMenu?.classList.add('translate-x-full');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        menuButton?.setAttribute('aria-expanded', 'false');
      } else {
        mobileMenu?.classList.add('translate-x-0');
        mobileMenu?.classList.remove('translate-x-full');
        menuIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        menuButton?.setAttribute('aria-expanded', 'true');
      }
    });

    // Mobile dropdown toggles
    const dropdownButtons = document.querySelectorAll('[data-mobile-dropdown]');
    dropdownButtons.forEach(button => {
      button.addEventListener('click', () => {
        const submenu = button.nextElementSibling as HTMLElement;
        const svg = button.querySelector('svg');
        const isOpen = submenu?.style.maxHeight && submenu.style.maxHeight !== '0px';

        if (isOpen) {
          submenu.style.maxHeight = '0';
          svg?.classList.remove('rotate-180');
        } else {
          submenu.style.maxHeight = submenu.scrollHeight + 'px';
          svg?.classList.add('rotate-180');
        }
      });
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', () => {
    initHeader();
    initMobileMenu();
  });

  // Re-initialize on page navigation (for SPA-like behavior)
  document.addEventListener('astro:page-load', () => {
    initHeader();
    initMobileMenu();
  });
</script>

<style>
  /* Ensure mobile menu is above content */
  #mobile-menu {
    z-index: 40;
  }
</style>
